<html>
  <head>
    <title>Authentication Example</title>
  </head>

  <body>
    <form>
      <p id="errors"></p>
      <div>
        <input id="email" type="email" placeholder="Enter your email">
      </div>
      <div>
        <input id="password" type="password" placeholder="Enter your password">
      </div>
      <div>
        <button id="sign-in">Sign In</button>
        <button id="sign-up">Register</button>

        <button id="sign-out">Sign Out</button>
      </div>
    </form>

    <script src="https://www.gstatic.com/firebasejs/live/3.0/firebase.js"></script>
    
    <script>
      var config = {
        apiKey: "AIzaSyDWxR3Y5dQj09Nr15VtC13VGnRWh9WgOV4",
        authDomain: "coding-output.firebaseapp.com",
        databaseURL: "https://coding-output-default-rtdb.firebaseio.com",
        storageBucket: "coding-output.appspot.com",
      };
      firebase.initializeApp(config);
    </script>

    <script>
      firebase.auth().onAuthStateChanged(function(user) {
        window.user = user;
      });
    </script>
    
    <script>    
      const validEmail = (email) => {
        // return true;
        return String(email)
          .toLowerCase()
          .match(
            /^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/
          );
      };
      
      const setError = (error) => {
        document.querySelector("#errors").innerHTML += `<p>${error}</p>`;
      }
      document.querySelector('#sign-up').addEventListener('click', function (e) {
        e.preventDefault();
        e.stopPropagation();
        resetError();
        var email = document.querySelector('#email').value;
        var password = document.querySelector('#password').value

        var validData = true;

        if (!validEmail(email)) {
          setError('The email address is badly formatted.');
          validData = false;
        };

        if (password.length < 6) {
          setError('The password must be 6 characters long or more.');
          validData = false;
        }

        if (!validData) return;
    
        firebase.auth().createUserWithEmailAndPassword(email, password)
          .then(function () {
            console.log('registered user');
            window.location = 'landingPage.html';
            // success = true;
          })
          .catch(function (err) {
            console.log('error signing up', err);
            setError(err.message);
          }); 
      });const resetError = () => {
        document.querySelector("#errors").innerHTML = '';
      }

      document.querySelector('#sign-in').addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        resetError();
        var email = document.querySelector('#email').value;
        var password = document.querySelector('#password').value

        var validData = true;

        if (!validEmail(email)) {
          setError('The email address is badly formatted.');
          validData = false;
        };

        if (password.length < 6) {
          setError('The password must be 6 characters long or more.');
          validData = false;
        }

        firebase.auth().signInWithEmailAndPassword(email, password)
          .then(function () {
            window.location = 'landingPage.html';
          })
          .catch(function (err) {
            console.log('error logging in', err);
            setError(err.message);
          })
      });
      
      document.querySelector('#sign-out').addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        firebase.auth().signOut();
      });
    </script>
  </body>
</html>